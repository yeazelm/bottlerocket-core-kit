[Unit]
Description=Link additional kernel modules
RequiresMountsFor=PREFIX/lib/modules PREFIX/src/kernels
Conflicts=link-telsa-kernel-modules.service
ConditionPathExists=/run/nvidia-open-gpu
# Rerunning this service after the system is fully loaded will override
# the already linked kernel modules. This doesn't affect the running system,
# since kernel modules are linked early in the boot sequence, but we still
# disable manual restarts to prevent unnecessary kernel modules rewrites.
RefuseManualStart=true
RefuseManualStop=true

[Service]
Type=oneshot
ExecStart=/usr/bin/driverdog --modules-set nvidia-open-gpu link-modules
RemainAfterExit=true
StandardError=journal+console

[Install]
RequiredBy=preconfigured.target
