# For any NVIDIA devices, ask ghostdog to select the right driver
SUBSYSTEM=="pci", OPTIONS="log_level=debug"
SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", IMPORT{program}=="/usr/bin/ghostdog match-nvidia-driver %s{vendor}", TAG+="systemd"

# If telsa, nothing more needed, driverdog will do the link/load
SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ENV{BOTTLEROCKET_NVIDIA_DRIVER}=="nvidia-telsa", GOTO="nvidia_end"

# Explictly go to open-gpu which adds a systemd_wants
SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ENV{BOTTLEROCKET_NVIDIA_DRIVER}=="nvidia-open-gpu", GOTO="nvidia_open_gpu"

LABEL="nvidia_open_gpu"
SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ENV{SYSTEMD_WANTS}="nvidia-open-gpu-modules.service", TAG+="systemd", GOTO="nvidia_end"

LABEL="nvidia_end"
